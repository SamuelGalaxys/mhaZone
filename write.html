<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>mhaZone</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
	<link rel="stylesheet" href="css/ready.css">
	<link rel="stylesheet" href="css/demo.css">
	<script src="js/includeHTML.js"></script>

</head>
<body>
	<div class="wrapper">
		<div class="main-header">
			<div class="logo-header">
				<a href="index.html" class="logo">
					mhaZone마한아존
				</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<button class="topbar-toggler more"><i class="la la-ellipsis-v"></i></button>
			</div>
			<nav class="navbar navbar-header navbar-expand-lg">
				<div class="container-fluid">
					
					
					
					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
						

						<li class="nav-item dropdown hidden-caret">
							<a class="nav-link dropdown-toggle" href="loginform.html" >
								<i class="la la-user"></i>
							</a>
							
						</li>



						
						<li class="nav-item dropdown hidden-caret">
							<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="la la-bell"></i>
								<span class="notification">!</span>
							</a>
							<ul class="dropdown-menu notif-box" aria-labelledby="navbarDropdown">
								<li>
									<div class="dropdown-title">공지 및 알림</div>
								</li>
								<li>
									<div class="notif-center">


										<a href="#">
											<div class="notif-icon notif-primary"> <i class="la la-user-plus"></i> </div>
											<div class="notif-content">
												<span class="block">
													--
												</span>
												<span class="time">-</span> 
											</div>
										</a>

										<a href="#">
											<div class="notif-icon notif-success"> <i class="la la-comment"></i> </div>
											<div class="notif-content">
												<span class="block">
													--
												</span>
												<span class="time">-</span> 
											</div>
										</a>
										
										
									</div>
								</li>
								<li>
									<a class="see-all" href="javascript:void(0);"> <strong>See all notifications</strong> <i class="la la-angle-right"></i> </a>
								</li>
							</ul>
						</li>

 
						
						
					</div>
				</nav>
			</div>


			<div class="sidebar">
				<div class="scrollbar-inner sidebar-wrapper">
					
					
					<nav include-html="nav.html"></nav>

					



				</div>
			</div>



			<div class="main-panel">
				<div class="content">
					<div class="container-fluid">
						<h4 class="page-title">게시판 및 공지</h4>

						<div class="row">
							<div class="col-md-6">


								<div id="scrollz" class="card" style="overflow:scroll;width:auto; height:490px;">
									<div class="card-header">
										<div class="card-title">업로드된 공지들</div>
									</div>
									<div class="card-body">
										<div class="card-sub">
											공지가 여기에 표시됩니다. 
										</div>
										<div class="noticelist"></div>

										
									</div>
								</div>


								 
 
								
								 

							</div>

							<div class="col-md-6">
								 


 
								<div class="card">
									<div class="card-header">
										<div class="card-title"><a style="color: rgb(0, 81, 255);">학생회 및 선생님 공지판</a></div>
									</div>
									<div class="form-group">			 
   
 									<div class="card-body">
										<textarea class="form-control w-100" rows="1" name="subject" id="subject" cols="30" placeholder="공지 제목"></textarea></br>
										<textarea class="form-control w-100" rows="5" name="comment" id="comment" cols="30" placeholder="공지할 내용을 입력해 주세요."></textarea></br>

										<div class="card-sub">		
											<textarea class="form-control w-100" rows="1" name="passcodemha" id="passcodemha" style="width:20px;" cols="10" placeholder="전용 업로드 비밀번호"></textarea></br>
							
											    on/off를 통해 팝업 여부 결정.
											<button type="button" class="button button-contactForm btn_1 boxed-btn btn btn-primary write" id="write" name="write">공지 업로드</button> 
											<input type="checkbox" checked data-toggle="toggle" data-onstyle="primary">

										</div>
 
									</div>

 								    </div>

						        </div>
								
								<div class="card">
									<div class="card-header">
										<div class="card-title"><a style="color: red;">김기훈의 관리자 공지판. 호스팅 테스트 용도. 작동X</a></div>
									</div>
									<div class="form-group">			 
   
 									<div class="card-body">
										<textarea class="form-control w-100" rows="1" name="subject" id="subject" cols="30" placeholder="공지 제목"></textarea></br>
										<textarea class="form-control w-100" rows="5" name="comment" id="comment" cols="30" placeholder="공지할 내용을 입력해 주세요."></textarea></br>

										<div class="card-sub">		
											<textarea class="form-control w-100" rows="1" name="comment" id="comment" style="width:20px;" cols="10" placeholder="PASSCODE"></textarea></br>
							
											    마한아존 공지가 업로드됩니다.
											<button type="button" class="button button-contactForm btn_1 boxed-btn btn btn-danger write" id="write" name="write">공지 업로드</button> 
 
										</div>
 
									</div>

 								    </div>
 								</div>




							</div>
						</div>
					</div>
				</div>
				<footer include-html="footer.html"></footer>

			</div>
		</div>
	</div>
</div>
<!-- Modal -->


<div class="modal fade" id="modalUpdateN" tabindex="-1" role="dialog" aria-labelledby="modalUpdatePro" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header bg-primary">
				<h6 class="modal-title"><i class="la la-info-circle"></i> 공지</h6>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body text-center">									
				<div id="scrollmodal" class="card" style="overflow:scroll;width:auto; height:400px;">
					 
					<div class="card-body">
						<div class="card-sub">
							공지가 여기에 표시됩니다. 
						</div>
						<div class="noticelist"></div>

						
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
</body>







<script src="js/core/jquery.3.2.1.min.js"></script>
<script src="js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
<script src="js/core/popper.min.js"></script>
<script src="js/core/bootstrap.min.js"></script>
<script src="js/plugin/chartist/chartist.min.js"></script>
<script src="js/plugin/chartist/plugin/chartist-plugin-tooltip.min.js"></script>
<script src="js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="js/plugin/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script src="js/plugin/jquery-mapael/jquery.mapael.min.js"></script>
<script src="js/plugin/jquery-mapael/maps/world_countries.min.js"></script>
<script src="js/plugin/chart-circle/circles.min.js"></script>
<script src="js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
<script src="js/ready.min.js"></script>
<script>
	$('#displayNotif').on('click', function(){
		var placementFrom = $('#notify_placement_from option:selected').val();
		var placementAlign = $('#notify_placement_align option:selected').val();
		var state = $('#notify_state option:selected').val();
		var style = $('#notify_style option:selected').val();
		var content = {};

		content.message = 'Turning standard Bootstrap alerts into "notify" like notifications';
		content.title = 'Bootstrap notify';
		if (style == "withicon") {
			content.icon = 'la la-bell';
		} else {
			content.icon = 'none';
		}
		content.url = 'index.html';
		content.target = '_blank';

		$.notify(content,{
			type: state,
			placement: {
				from: placementFrom,
				align: placementAlign
			},
			time: 1000,
		});
	});
</script>
<script>
    includeHTML();
</script>

<script src="js/time.js"></script>
<!--login유무 session js 파일 -->
<script src="js/sessionCheck.js"></script>
<!--스크립트 부분. 자신의 스크립트 코드로 변경하세요! -->
<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script>
 
  

    //스크롤 자동으로 내리기
    //setInterval(updateScroll,1000);   

	function updateScroll(){
    var element = document.getElementById("scrollz");
    element.scrollTop = element.scrollHeight;
    }
 
 




	var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
	var firebaseDatabase; //파이어베이스 db 모듈 전역변수
	var name; //유저 이름
	var loginUserKey; //로그인한 유저의 부모 key
	var userInfo; //로그인한 유저의 정보 object type






	//파이어 베이스 초기화 코드
	var config = {
		apiKey: "AIzaSyDQLUtjdMgOLDIZlPusi5YPKBiuQduD9Go",
		databaseURL: "https://mhazone-mha-default-rtdb.firebaseio.com/",
        authDomain: "mhazone-mha.firebaseapp.com",
        projectId: "mhazone-mha",
        storageBucket: "mhazone-mha.appspot.com",
        messagingSenderId: "967342331429",
        appId: "1:967342331429:web:8a5689ea4c254f037951cc",
        measurementId: "G-Z33QJ15H02"
	 
	};
	//파이어베이스 초기화
	firebase.initializeApp(config);
	//인증모듈 객체 가져오기
	firebaseEmailAuth = firebase.auth();
	//데이터베이스 모듈객체 가져오기
	firebaseDatabase = firebase.database();

	//세션 체크 함수
	userSessionCheck();



	$(document).ready(function () {

		//메인화면 쓰기버튼 눌렀을 때
		$(document).on('click', '.write', function () {

			//네비게이션 메뉴의 text값 가져오기 - 자바스크립트 dom 방식으로 가져왔다.
			var seseionCheck = document.getElementById("loginmenu").textContent;

			//텍스트 필드에 있는 내용 가져오기!!!!
			comment = $('#comment').val();
			subject = $('#subject').val();
			pswdmha = $('#passcodemha').val();


			if (seseionCheck == "로그아웃") {
				//저장하기
				saveThanks();
			} else {
				alert("로그인이 필요한 서비스 입니다.")
			}
		});
	});



	//쓰기 버튼 눌렀을 때 호출 되는 함수
	function saveThanks() {


        //맞아. 귀찮아서 보안에 신경 안 썻어...지금 개발자모드로 이걸 보고있겠지...넌
		if (pswdmha == "MHAZONE2021"){


         //thanks 라는 테이블을 만들고 하위 데이터에 유저 아이디를 넣어준다. 그곳에 push로 가상의 키를 넣고, 객체를 넣어준다.!!!!
		var thankRef = firebaseDatabase.ref("notice");

		// 해당 객체의 key 값이 자동으로 생성된다.
		var thank = thankRef.push(); // 해당 객체의 key 값이 자동으로 생성된다.




		//로그인한 유저의 pk값,이름,내용,시간 데이터
		var obj = {
			name: name,
			userkey: loginUserKey,
			comment: comment,
			subject: subject,
			createtime: currentTime
		};
		//위에서 thankRef.push()로 만들어진 key아래 위치에 저장해준다.
		thank.set(obj);
  
		
		alert("글이 업로드 되었습니다");

		$('#comment').val("");
		$('#subject').val("");



		}else{
			alert("비밀번호 불일치");

		}
		$('#passcodemha').val("");

		 

	}



	//글 목록가져와서 뿌려주기
	function thanksList() {
		//alert("보드 로드 완료")

		//로그인한 유저라면
		if (loginUserKey) {
			//alert(loginUserKey)
			//글이 저장된 레퍼런스 값 가져오기
			var thanksRef = firebaseDatabase.ref('notice');
			//on 함수로 글 목록가져오기
			thanksRef.on('child_added', on_thanks_list)

		} else {
			//로그인 아니어도 글 보이게
			//alert(loginUserKey)
			//글이 저장된 레퍼런스 값 가져오기
			var thanksRef = firebaseDatabase.ref('notice');
			//on 함수로 글 목록가져오기
			thanksRef.on('child_added', on_thanks_list)
		}

	}

	//게시판 리스트 thanks 테이블의 thanks 키 들을 연속적으로 가져옴...ㅋㅋㅋㅋㅋ
	function on_thanks_list(data) {
		console.log("on_thanks_list() 함수안으로 들어왔습니다 리스트를 가져오겠습니다")
		var key = data.key;

		var Data = data.val();
		var comment = Data.comment;
		var createtime = Data.createtime;
		var name = Data.name;
		var subject = Data.subject;
		var userkey = Data.userkey;

		//무슨값이 넘어오는지 찍어보세요
		//alert(comment +"/"+ createtime + "/"+name +"/"+userkey);


		//리스트 동적으로 붙이기
		var html =
                "<div class=\"card\" id='" + userkey + "' onclick=\"show_user_page(this.id)\">" +
                "<div class=\"card-header\">" +
                "<h4 class=\"media-heading\"><strong STYLE=\"color: #424242; font-size: 16pt\">" + subject + "</strong>" +
                " <span STYLE=\"color: black; font-size: 11pt\">" + "</br>" + comment + "</span></h4>" +
                "<p STYLE=\"color: black; font-size: 10pt\">" + "<i class=\"la la-user\">" + "</i>" + name + " :: " + createtime + "</p></div></div>";

            $(".noticelist").prepend(html);

	}


</script>


</html>